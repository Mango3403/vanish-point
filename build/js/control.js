!function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){"use strict";let o,a,r,i;n.r(t),n.d(t,"setupCanvasDrawing",function(){return p}),n.d(t,"draw",function(){return c}),n.d(t,"setBackgroundTransparent",function(){return u}),n.d(t,"setBackgroundColor",function(){return f}),n.d(t,"addText",function(){return m}),n.d(t,"addImage",function(){return w});document.getElementById("drawing-text-input");let d=document.getElementById("drawing-text-btn"),l=document.getElementById("drawing-image-btn"),s=!1;function p(e){o=new fabric.Canvas("drawing-canvas"),a=new THREE.Vector2,r=o.lowerCanvasEl,(i=r.getContext("2d")).fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,128,128),e.map=new THREE.CanvasTexture(r),r.addEventListener("mousedown",function(e){s=!0,a.set(e.offsetX,e.offsetY)}),r.addEventListener("mousemove",function(t){s&&c(e,i,t.offsetX,t.offsetY)}),r.addEventListener("mouseup",function(){s=!1}),r.addEventListener("mouseleave",function(){s=!1})}function c(e,t,n,o){t.moveTo(a.x,a.y),t.strokeStyle="#FFFFFF",t.lineTo(n,o),t.stroke(),a.set(n,o),e.map.needsUpdate=!0}function u(){let{plane:e}=planes[0];e.material.transparent=!0}function f(){let{plane:e}=planes[0];e.material.transparent=!1}function m(){d.addEventListener("click",function(){let e=new fabric.Text("你好",{left:30,top:30,stroke:"#FFFFFF"});o.add(e)},!1)}function w(){l.addEventListener("click",function(){fabric.Image.fromURL("/media/shoe.jpg",function(e){e.scaleX=e.scaleY=.1,e.filters.push(new fabric.Image.filters.Grayscale),e.applyFilters(),o.add(e)})},!1)}},function(e,t,n){"use strict";n.r(t),n.d(t,"floors",function(){return h}),n.d(t,"initBack",function(){return _}),n.d(t,"initOver",function(){return b}),n.d(t,"animate",function(){return R});var o=n(0);let a,r,i,d,l,s,p,c,u,f=window.innerWidth,m=window.innerHeight,w=document.getElementById("three_back"),y=document.getElementById("three_over"),g=75,E={window_width:window.innerWidth,window_height:window.innerHeight,repeat_x:35,repeat_y:140,left:-100,top:-7e3,far:7e3,plane:{pos_x:0,pos_y:1,pos_z:0,scale_x:2,scale_y:3.5,rot_x:Math.PI/2,rot_y:-Math.PI,rot_z:Math.PI}},h=[],x=[];function _(){a=new THREE.Scene,(i=new THREE.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0})).shadowMap.enabled=!0,i.shadowMap.soft=!0,w.append(i.domElement),T(a),function(e){(r=new THREE.PerspectiveCamera(g,f/m,.1,e)).position.x=0,r.position.y=200,r.position.z=512;let t=(new THREE.Vector3).copy(r.position),n=2*Math.tan(g/2*Math.PI/180);t.x+=-.01*n,t.y+=.022*n,t.z+=-1,r.lookAt(t),r.updateProjectionMatrix()}(E.far),function(e,t,n,o,a,r){let i=new THREE.Texture(document.getElementById(e));i.wrapS=i.wrapT=THREE.RepeatWrapping,i.anisotropy=2,i.repeat.set(a,r),i.needsUpdate=!0;let d=new THREE.MeshBasicMaterial({map:i}),l=new THREE.PlaneBufferGeometry(1024*n,1024*o,10,10),s=new THREE.Mesh(l,d);s.rotation.x=-Math.PI/2,s.rotation.z=Math.PI,s.position.x=E.left,s.position.z=E.top,h.push({floor:s,repeatX:a,repeatY:r}),t.add(s)}("tex_floor_1",a,5,20,E.repeat_x,E.repeat_y),function(e){let t=new dat.GUI,n=t.addFolder("floor");n.add(E,"repeat_x",1,200).onChange(function(e){let{floor:t,repeatX:n}=h[0];n=e,t.material.map.repeat.setX(e),t.material.needsUpdate=!0}),n.add(E,"repeat_y",1,200).onChange(function(e){let{floor:t,repeatY:n}=h[0];repeatX=e,t.material.map.repeat.setY(e),t.material.needsUpdate=!0}),n.add(E,"left",-1e4,1e4).onChange(function(e){let{floor:t}=h[0];t.position.x=e}),n.add(E,"top",-1e4,1e4).onChange(function(e){let{floor:t}=h[0];t.position.z=e}),t.open()}(h[0].floor),u=new Stats,document.body.appendChild(u.dom),window.addEventListener("resize",v(r,i),!1)}function b(){d=new THREE.Scene,(s=new THREE.WebGLRenderer({antialias:!0,alpha:!0,preserveDrawingBuffer:!0})).setClearColor(15658734,0),s.shadowMap.enabled=!0,s.shadowMap.soft=!0,y.append(s.domElement),T(d),function(e){(l=new THREE.PerspectiveCamera(g,f/m,.1,e)).position.x=0,l.position.y=200,l.position.z=512;let t=(new THREE.Vector3).copy(l.position),n=2*Math.tan(g/2*Math.PI/180);t.x+=-.01*n,t.y+=.022*n,t.z+=-1,l.lookAt(t),l.updateProjectionMatrix()}(E.far),function(e){let t=new THREE.PlaneBufferGeometry(200,100,32),n=new THREE.MeshLambertMaterial({transparent:!0,side:THREE.DoubleSide});c=new THREE.Mesh(t,n),Object(o.setupCanvasDrawing)(n),console.log("使用了"),Object(o.addText)(),Object(o.addImage)(),c.rotation.x=E.plane.rot_x,c.rotation.y=E.plane.rot_y,c.rotation.z=E.plane.rot_z,c.position.x=E.plane.pos_x,c.position.y=E.plane.pos_y,c.position.z=E.plane.pos_z,c.scale.x=E.plane.scale_x,c.scale.y=E.plane.scale_y,x.push({plane:c}),e.add(c)}(d),function(e){let t=new dat.GUI,n=t.addFolder("plane");n.add(e,"pos_x",-1e3,1e3).onChange(function(e){c.position.x=e}),n.add(e,"pos_y",1,1e3).onChange(function(e){c.position.y=e}),n.add(e,"pos_z",-3e3,1e3).onChange(function(e){c.position.z=e}),n.add(e,"scale_x",.1,10).onChange(function(e){c.scale.x=e}).listen(),n.add(e,"scale_y",.1,10).onChange(function(e){c.scale.y=e}).listen(),n.add(e,"rot_x",0,2*Math.PI).onChange(function(e){c.rotation.x=e}).step(Math.PI/4),n.add(e,"rot_y",0,2*Math.PI).onChange(function(e){c.rotation.y=e}).step(Math.PI/4),n.add(e,"rot_z",0,2*Math.PI).onChange(function(e){c.rotation.z=e}).step(Math.PI/4),t.open()}(E.plane),window.addEventListener("resize",v(l,s),!1)}function T(e){p=new THREE.AmbientLight(16777215),e.add(p)}function v(e,t){let n=window.innerWidth,o=window.innerHeight;e&&(e.aspect=n/o,e.updateProjectionMatrix()),t&&t.setSize(n,o)}function M(e,t,n){v(r,i),v(l,s),E.window_width=window.innerWidth,E.window_height=window.innerHeight,e.render(t,n)}function R(){requestAnimationFrame(R),M(i,a,r),M(s,d,l),u.update()}},function(e,t,n){"use strict";n.r(t),n.d(t,"setFloorBtn",function(){return s}),n.d(t,"setSceneBtn",function(){return p}),n.d(t,"changeScene",function(){return c});var o=n(1);let a=document.querySelector("#floor_1"),r=document.querySelector("#scene_btn"),i=document.querySelector("#scene_grid"),d=document.querySelectorAll("#scene_grid img"),l=document.querySelector("#overlay");document.querySelector(".foo-button");function s(){a.style.position="absolute",a.style.left=window.innerWidth/2+"px",a.style.bottom="30px",a.onclick=function(){let{floor:e,repeatX:t,repeatY:n}=o.floors[0];/1.png/.test(e.material.map.image.src)?e.material.map=(new THREE.TextureLoader).load("media/floor_sample_2.png"):e.material.map=(new THREE.TextureLoader).load("media/floor_sample_1.png"),e.material.map.wrapS=e.material.map.wrapT=THREE.RepeatWrapping,e.material.map.anisotropy=2,e.material.needsUpdate=!0,e.material.map.repeat.setX(t),e.material.map.repeat.setY(n)}}function p(){r.style.position="fixed",r.style.right="20px",r.style.bottom="20px",r.onclick=function(){"flex"===getComputedStyle(i).display?i.style.display="none":i.style.display="flex"}}function c(){d.forEach(e=>{e.onclick=function(){/1/.test(e.getAttribute("src"))?a.style.display="block":a.style.display="none",l.setAttribute("src",e.getAttribute("src"))}})}}]);